  <!DOCTYPE html>
  <html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Neovim user documentation">

    <!-- algolia docsearch https://docsearch.algolia.com/docs/docsearch-v3/ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" />
    <link rel="preconnect" href="https://X185E15FPG-dsn.algolia.net" crossorigin />

    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/main.css" rel="stylesheet">
    <link href="help.css" rel="stylesheet">
    <link href="/highlight/styles/neovim.min.css" rel="stylesheet">

    <script src="/highlight/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <title> Dev_vimpatch - Neovim docs</title>
  </head>
  <body>
    <header class="container">
    <nav class="navbar navbar-expand-lg">
      <div class="container-fluid">
        <a href="/" class="navbar-brand" aria-label="logo">
          <!--TODO: use <img src="â€¦.svg"> here instead. Need one that has green lettering instead of gray. -->
              <svg xmlns="http://www.w3.org/2000/svg" role="img" width="173" height="50" viewBox="0 0 742 214" aria-label="Neovim">
      <title>Neovim</title>
      <defs>
        <linearGradient x1="50%" y1="0%" x2="50%" y2="100%" id="a">
          <stop stop-color="#16B0ED" stop-opacity=".8" offset="0%" />
          <stop stop-color="#0F59B2" stop-opacity=".837" offset="100%" />
        </linearGradient>
        <linearGradient x1="50%" y1="0%" x2="50%" y2="100%" id="b">
          <stop stop-color="#7DB643" offset="0%" />
          <stop stop-color="#367533" offset="100%" />
        </linearGradient>
        <linearGradient x1="50%" y1="0%" x2="50%" y2="100%" id="c">
          <stop stop-color="#88C649" stop-opacity=".8" offset="0%" />
          <stop stop-color="#439240" stop-opacity=".84" offset="100%" />
        </linearGradient>
      </defs>
      <g fill="none" fill-rule="evenodd">
        <path
          d="M.027 45.459L45.224-.173v212.171L.027 166.894V45.459z"
          fill="url(#a)"
          transform="translate(1 1)"
        />
        <path
          d="M129.337 45.89L175.152-.149l-.928 212.146-45.197-45.104.31-121.005z"
          fill="url(#b)"
          transform="matrix(-1 0 0 1 305 1)"
        />
        <path
          d="M45.194-.137L162.7 179.173l-32.882 32.881L12.25 33.141 45.194-.137z"
          fill="url(#c)"
          transform="translate(1 1)"
        />
        <path
          d="M46.234 84.032l-.063 7.063-36.28-53.563 3.36-3.422 32.983 49.922z"
          fill-opacity=".13"
          fill="#000"
        />
        <g fill="#444">
          <path
            d="M227 154V64.44h4.655c1.55 0 2.445.75 2.685 2.25l.806 13.502c4.058-5.16 8.786-9.316 14.188-12.466 5.4-3.15 11.413-4.726 18.037-4.726 4.893 0 9.205.781 12.935 2.34 3.729 1.561 6.817 3.811 9.264 6.751 2.448 2.942 4.297 6.48 5.55 10.621 1.253 4.14 1.88 8.821 1.88 14.042V154h-8.504V96.754c0-8.402-1.91-14.987-5.729-19.757-3.82-4.771-9.667-7.156-17.544-7.156-5.851 0-11.28 1.516-16.292 4.545-5.013 3.032-9.489 7.187-13.427 12.467V154H227zM350.624 63c5.066 0 9.755.868 14.069 2.605 4.312 1.738 8.052 4.268 11.219 7.592s5.638 7.412 7.419 12.264C385.11 90.313 386 95.883 386 102.17c0 1.318-.195 2.216-.588 2.696-.393.48-1.01.719-1.851.719h-64.966v1.70c0 6.708.784 12.609 2.353 17.7 1.567 5.09 3.8 9.357 6.695 12.802 2.895 3.445 6.393 6.034 10.495 7.771 4.1 1.738 8.686 2.606 13.752 2.606 4.524 0 8.446-.494 11.762-1.483 3.317-.988 6.108-2.097 8.37-3.324 2.261-1.227 4.056-2.336 5.383-3.324 1.326-.988 2.292-1.482 2.895-1.482.784 0 1.388.3 1.81.898l2.352 2.875c-1.448 1.797-3.362 3.475-5.745 5.031-2.383 1.558-5.038 2.891-7.962 3.998-2.926 1.109-6.062 1.991-9.41 2.65a52.21 52.21 0 01-10.088.989c-6.152 0-11.762-1.064-16.828-3.19-5.067-2.125-9.415-5.225-13.043-9.298-3.63-4.074-6.435-9.06-8.415-14.96C310.99 121.655 310 114.9 310 107.294c0-6.408.92-12.323 2.76-17.744 1.84-5.421 4.493-10.093 7.961-14.016 3.467-3.922 7.72-6.991 12.758-9.209C338.513 64.11 344.229 63 350.624 63zm.573 6c-4.696 0-8.904.702-12.623 2.105-3.721 1.404-6.936 3.421-9.65 6.053-2.713 2.631-4.908 5.79-6.586 9.474S319.55 94.439 319 99h60c0-4.679-.672-8.874-2.013-12.588-1.343-3.712-3.232-6.856-5.67-9.43-2.44-2.571-5.367-4.545-8.782-5.92-3.413-1.374-7.192-2.062-11.338-2.062zM435.546 63c6.526 0 12.368 1.093 17.524 3.28 5.154 2.186 9.5 5.286 13.04 9.298 3.538 4.013 6.238 8.85 8.099 14.51 1.861 5.66 2.791 11.994 2.791 19.002 0 7.008-.932 13.327-2.791 18.957-1.861 5.631-4.561 10.452-8.099 14.465-3.54 4.012-7.886 7.097-13.04 9.254-5.156 2.156-10.998 3.234-17.524 3.234-6.529 0-12.369-1.078-17.525-3.234-5.155-2.157-9.517-5.242-13.085-9.254-3.57-4.013-6.285-8.836-8.145-14.465-1.861-5.63-2.791-11.95-2.791-18.957 0-7.008.93-13.342 2.791-19.002 1.861-5.66 4.576-10.496 8.145-14.51 3.568-4.012 7.93-7.112 13.085-9.299C423.177 64.094 429.017 63 435.546 63zm-.501 86c5.341 0 10.006-.918 13.997-2.757 3.99-1.838 7.32-4.474 9.992-7.909 2.67-3.435 4.664-7.576 5.986-12.428 1.317-4.85 1.98-10.288 1.98-16.316 0-5.965-.66-11.389-1.98-16.27-1.322-4.88-3.316-9.053-5.986-12.519-2.67-3.463-6-6.13-9.992-7.999-3.991-1.867-8.657-2.802-13.997-2.802s-10.008.935-13.997 2.802c-3.991 1.87-7.322 4.536-9.992 8-2.671 3.465-4.68 7.637-6.03 12.518-1.35 4.881-2.026 10.305-2.026 16.27 0 6.026.675 11.465 2.025 16.316 1.35 4.852 3.36 8.993 6.031 12.428 2.67 3.435 6 6.07 9.992 7.91 3.99 1.838 8.656 2.756 13.997 2.756z"
            fill="currentColor"
          />
          <path
            d="M530.57 152h-20.05L474 60h18.35c1.61 0 2.967.39 4.072 1.166 1.103.778 1.865 1.763 2.283 2.959l17.722 49.138a92.762 92.762 0 012.551 8.429c.686 2.751 1.298 5.5 1.835 8.25.537-2.75 1.148-5.499 1.835-8.25a77.713 77.713 0 012.64-8.429l18.171-49.138c.417-1.196 1.164-2.181 2.238-2.96 1.074-.776 2.356-1.165 3.849-1.165H567l-36.43 92zM572 61h23v92h-23zM610 153V60.443h13.624c2.887 0 4.78 1.354 5.682 4.06l1.443 6.856a52.7 52.7 0 015.097-4.962 32.732 32.732 0 015.683-3.879 30.731 30.731 0 016.496-2.57c2.314-.632 4.855-.948 7.624-.948 5.832 0 10.63 1.579 14.39 4.736 3.758 3.157 6.57 7.352 8.434 12.585 1.444-3.068 3.248-5.698 5.413-7.894 2.165-2.194 4.541-3.984 7.127-5.367a32.848 32.848 0 018.254-3.068 39.597 39.597 0 018.796-.992c5.111 0 9.653.783 13.622 2.345 3.97 1.565 7.307 3.849 10.014 6.857 2.706 3.007 4.766 6.675 6.18 11.005C739.29 83.537 740 88.5 740 94.092V153h-22.284V94.092c0-5.894-1.294-10.329-3.878-13.306-2.587-2.977-6.376-4.465-11.368-4.465-2.286 0-4.404.391-6.358 1.172a15.189 15.189 0 00-5.144 3.383c-1.473 1.474-2.631 3.324-3.474 5.548-.842 2.225-1.263 4.781-1.263 7.668V153h-22.37V94.092c0-6.194-1.249-10.704-3.744-13.532-2.497-2.825-6.18-4.24-11.051-4.24-3.19 0-6.18.798-8.976 2.391-2.799 1.593-5.399 3.775-7.804 6.54V153H610zM572 30h23v19h-23z"
            fill="currentColor"
            fill-opacity=".8"
          />
        </g>
      </g>
    </svg>
  
          <!--<img src="https://neovim.io/logos/neovim-logo.svg" width="173" height="50" alt="Neovim" />-->
        </a>
        <div id="docsearch"></div> <!-- algolia docsearch https://docsearch.algolia.com/docs/docsearch-v3/ -->
      </div>
    </nav>
  </header>

  <div class="container golden-grid help-body">
  <div class="col-wide">
  <a name="dev_vimpatch.txt" href="#dev-vimpatch"><h1 id="dev-vimpatch"> Dev_vimpatch</h1></a>
  <p>
    <i>
    Nvim <code>:help</code> pages, <a href="https://github.com/neovim/neovim/blob/master/src/gen/gen_help_html.lua">generated</a>
    from <a href="https://github.com/neovim/neovim/blob/master/runtime/doc/dev_vimpatch.txt">source</a>
    using the <a href="https://github.com/neovim/tree-sitter-vimdoc">tree-sitter-vimdoc</a> parser.
    </i>
  </p>
  <hr/>
  <div class="help-para">
Merging patches from Vim

</div>
<div class="help-para">
Nvim was forked from Vim 7.4.160; it is kept up-to-date with relevant Vim
patches in order to avoid duplicate work. Run <code>vim-patch.sh</code>
<a href="https://github.com/neovim/neovim/blob/master/scripts/vim-patch.sh">https://github.com/neovim/neovim/blob/master/scripts/vim-patch.sh</a> to see the
status of Vim patches:
<pre><code class="language-bash">./scripts/vim-patch.sh -l</code></pre>

</div>
<div class="help-para">
Everyone is welcome to <a href="dev_vimpatch.html#dev-vimpatch-pull-requests">dev-vimpatch-pull-requests</a> for relevant Vim
patches, but some types of patches are <a href="dev_vimpatch.html#dev-vimpatch-not-applicable">dev-vimpatch-not-applicable</a>.
See <a href="dev_vimpatch.html#dev-vimpatch-quickstart">dev-vimpatch-quickstart</a> to get started immediately.

</div>
<div class="help-para">
<h2 id="_quickstart" class="help-heading">QUICKSTART<span class="help-heading-tags">                                        <span id="dev-vimpatch-quickstart" class="help-tag"><a href="#dev-vimpatch-quickstart">dev-vimpatch-quickstart</a></span></h2>


</div>
<div class="help-para">
1. Pull the Nvim source:
<pre><code class="language-bash">git clone https://github.com/neovim/neovim.git</code></pre>

</div>
<div class="help-para">
2. Run <code>./scripts/vim-patch.sh -l</code> to see the list of missing Vim patches.

</div>
<div class="help-para">
3. Choose a patch from the list (usually the oldest one), e.g. <code>8.0.0123</code>.

</div>
<div class="help-para">
<div class="help-li" style=""> Check for open vim-patch PRs
     <a href="https://github.com/neovim/neovim/pulls?q=is%3Apr+is%3Aopen+label%3Avim-patch">https://github.com/neovim/neovim/pulls?q=is%3Apr+is%3Aopen+label%3Avim-patch</a>.
</div>
</div>
<div class="help-para">
4. Run <code>./scripts/vim-patch.sh -p 8.0.0123</code>

</div>
<div class="help-para">
5. Follow the instructions given by the script.

</div>
<div class="help-para">
<div class="help-column_heading">NOTES</div>

</div>
<div class="help-para">
<div class="help-li" style=""> It's strongly recommended to work on the oldest missing patch, because
  later patches might depend on the changes.
</div><div class="help-li" style=""> Use <code>git log --grep</code> or <code>git log -G</code> to search the Nvim/Vim source history
  (even deleted code). E.g. to find <code>reset_option_was_set</code>:<pre><code class="language-bash">git log -p -G reset_option_was_set</code></pre>
</div>
</div>
<div class="help-para">
<div class="help-li" style=""> Pass <code>git log</code> options like <code>--grep</code> and <code>-G</code> to <code>./scripts/vim-patch.sh -L</code>
  to filter unmerged Vim patches E.g. to find <code>+quickfix</code> patches:<pre><code class="language-bash">./scripts/vim-patch.sh -L --grep quickfix -- src</code></pre>
</div>
</div>
<div class="help-para">
<h2 id="_pull-requests" class="help-heading">PULL REQUESTS<span class="help-heading-tags">                                  <span id="dev-vimpatch-pull-requests" class="help-tag"><a href="#dev-vimpatch-pull-requests">dev-vimpatch-pull-requests</a></span></h2>


</div>
<div class="help-para">
<b>Note:</b> vim-patch.sh automates these steps for you. Use it!

</div>
<div class="help-para">
<div class="help-li" style=""> Install <code>gh</code> (<a href="https://cli.github.com/">https://cli.github.com/</a>) if you want to use <code>vim-patch.sh</code> to
  create PRs automatically
</div><div class="help-li" style=""> The pull request title should include <code>vim-patch:8.x.xxxx</code> (no whitespace)
</div><div class="help-li" style=""> The commit message
  <a href="https://github.com/neovim/neovim/commit/4ccf1125ff569eccfc34abc4ad794044c5ab7455">https://github.com/neovim/neovim/commit/4ccf1125ff569eccfc34abc4ad794044c5ab7455</a>
  should include:
</div><div class="help-li" style="margin-left: 3rem;"> A token indicating the Vim patch number, formatted as follows:
      <code>vim-patch:8.0.0123</code> (no whitespace)
</div><div class="help-li" style="margin-left: 3rem;"> A URL pointing to the Vim commit:
      <a href="https://github.com/vim/vim/commit/c8020ee825b9d9196b1329c0e097424576fc9b3a">https://github.com/vim/vim/commit/c8020ee825b9d9196b1329c0e097424576fc9b3a</a>
</div><div class="help-li" style="margin-left: 3rem;"> The original Vim commit message, including author
</div>
</div>
<div class="help-para">
Reviewers: hint for reviewing <code>runtime/</code> patches
<a href="https://github.com/neovim/neovim/pull/1744#issuecomment-68202876">https://github.com/neovim/neovim/pull/1744#issuecomment-68202876</a>

</div>
<div class="help-para">
<h2 id="_na-(not-applicable)-patches" class="help-heading">NA (NOT APPLICABLE) PATCHES<span class="help-heading-tags">                    <span id="dev-vimpatch-not-applicable" class="help-tag"><a href="#dev-vimpatch-not-applicable">dev-vimpatch-not-applicable</a></span></h2>


</div>
<div class="help-para">
Many Vim patches are not applicable to Nvim. If you find NA patches, visit an
open "version.c: update" pull request
<a href="https://github.com/neovim/neovim/pulls?q=is%3Apr+author%3Aapp%2Fgithub-actions+version.c+is%3Aopen">https://github.com/neovim/neovim/pulls?q=is%3Apr+author%3Aapp%2Fgithub-actions+version.c+is%3Aopen</a>
and mention the NA patches in a comment (please edit/update one comment,
rather than adding a new comment for each patch).

</div>
<div class="help-para">
If there are no open <code>version.c: update</code> pull requests, include NA patches in
a commit message in the following format:
<pre>vim-patch:&lt;version-or-commit&gt;
vim-patch:&lt;version-or-commit&gt;
...</pre>

</div>
<div class="help-para">
where <code>&lt;version-or-commit&gt;</code> is a valid Vim version (like <code>8.0.0123</code>) or
commit-id (SHA). Each patch is on a separate line.

</div>
<div class="help-para">
It is preferred to include NA patches by squashing it in applicable Vim
patches, especially if the Vim patches are related. First line of the commit
message should be from the applicable Vim patch.
<pre>./scripts/vim-patch -p &lt;na-patch&gt;
./scripts/vim-patch -p &lt;na-patch&gt;
...
./scripts/vim-patch -P &lt;patch&gt;
git rebase -i master</pre>

</div>
<div class="help-para">
Example:
<a href="https://github.com/neovim/neovim/commit/00f60c2ce78fc1280e93d5a36bc7b2267d5f4ac6">https://github.com/neovim/neovim/commit/00f60c2ce78fc1280e93d5a36bc7b2267d5f4ac6</a>

</div>
<div class="help-para">
<div class="help-column_heading">TYPES OF "NOT APPLICABLE" VIM PATCHES</div>

</div>
<div class="help-para">
<div class="help-li" style=""> Vim9script features, and anything related to <code>:scriptversion</code>. (Nvim
  supports Vimscript version 1 only.) Be aware that patches labelled <code>Vim9:</code>
  may still contain applicable fixes to other parts of the codebase, so these
  patch need to be checked individually.
</div><div class="help-li" style=""> Updates to <code>testdir/Makefile</code> are usually NA because the Makefile implicitly
  finds
  <a href="https://github.com/neovim/neovim/commit/8a677f8a4bff6005fa39f090c14e970c3dfdbe6e#diff-b3c6ad6680a25a1b42095879e3a87104R52">https://github.com/neovim/neovim/commit/8a677f8a4bff6005fa39f090c14e970c3dfdbe6e#diff-b3c6ad6680a25a1b42095879e3a87104R52</a>
  all <code>test_*.vim</code> files.
</div><div class="help-li" style=""> Compiler warning fixes: Nvim strives to have no warnings at all, and has a
  very different build system from Vim.
</div><div class="help-li" style="margin-left: 3rem;"><b> Note:</b> Coverity fixes in Vim are relevant to Nvim.
</div><div class="help-li" style=""> <code>*.proto</code> changes: Nvim autogenerates function prototypes
</div><div class="help-li" style=""> <code>#ifdef</code> tweaking: For example, Vim decided to enable <code>FEAT_VISUAL</code> for all
  platforms - but Nvim already does that. Adding new <code>FEAT_</code> guards also isn't
  relevant to Nvim.
</div><div class="help-li" style=""> Legacy system support: Fixes for legacy systems such as Amiga, OS/2 Xenix,
  Mac OS 9, Windows older than XP SP2, are not needed because they are not
  supported by Nvim.
</div><div class="help-li" style="margin-left: 3rem;"> NA files: <code>src/Make_*</code>, <code>src/testdir/Make__*</code>
</div><div class="help-li" style=""> <code>if_*.c</code> changes: <code>if_python.c</code> et. al. were removed.
</div><div class="help-li" style=""> <code>term.c</code> changes: the Nvim TUI uses <code>libtermkey</code> to read terminal sequences;
  Vim's <code>term.c</code> was removed.
</div><div class="help-li" style=""> <code>job</code> patches: incompatible API and implementation
</div><div class="help-li" style="margin-left: 3rem;"> NA files: <code>src/channel_*</code>, <code>src/job_*</code>, <code>src/testdir/test_channel_*</code>,
      <code>src/testdir/test_job_*</code>
</div><div class="help-li" style=""> <code>:terminal</code> patches that modify NA files: incompatible API and
  implementation
</div><div class="help-li" style="margin-left: 3rem;"> NA files: <code>src/terminal_*</code>, <code>src/testdir/test_terminal_*</code>
</div><div class="help-li" style=""> <code>defaults.vim</code> patches
</div><div class="help-li" style=""> Most GUI-related changes: Nvim GUIs are implemented external to the core C
  codebase.
</div><div class="help-li" style="margin-left: 3rem;"> NA files: <code>src/gui_*</code>, <code>src/gvim_*</code>, <code>src/GvimExt/*</code>, <code>src/testdir/test_gui*</code>
</div><div class="help-li" style=""> <code>balloon</code> changes: Nvim does not support balloon feature
</div><div class="help-li" style="margin-left: 3rem;"> NA files: <code>src/beval_*</code>, <code>src/testdir/test_balloon_*</code>
</div><div class="help-li" style=""> Screendump tests from <code>test_popupwin.vim</code>, <code>test_popupwin_textprop.vim</code>:
  <a href="https://github.com/neovim/neovim/pull/12741#issuecomment-704677141">https://github.com/neovim/neovim/pull/12741#issuecomment-704677141</a>
</div><div class="help-li" style=""> json changes: incompatible API <a href="https://github.com/neovim/neovim/pull/4131">https://github.com/neovim/neovim/pull/4131</a>
</div><div class="help-li" style="margin-left: 3rem;"> NA files: <code>src/json*</code>, <code>src/testdir/test_json.vim</code>
</div><div class="help-li" style=""> <code>test_restricted.vim</code> restricted mode is removed in
  <a href="https://github.com/neovim/neovim/pull/11996">https://github.com/neovim/neovim/pull/11996</a>
</div><div class="help-li" style=""> Many tests in <code>test_prompt_buffer.vim</code> require incompatible Vim features
  such as <code>channel</code>; they should still be included, but skipped
</div><div class="help-li" style=""> non-runtime documentation: Moved to <a href="https://neovim.io/doc/,">https://neovim.io/doc/,</a>
</div><div class="help-li" style="margin-left: 3rem;"> NA files: <code>Filelist</code>, <code>README</code>, <code>INSTALL</code>,
</div><div class="help-li" style=""> Anything else might be relevant; err on the side of caution, and post an
  issue if you aren't sure.
</div>
</div>
<div class="help-para">
<h2 id="_version.c" class="help-heading">VERSION.C<span class="help-heading-tags">                                          <span id="dev-vimpatch-version.c" class="help-tag"><a href="#dev-vimpatch-version.c">dev-vimpatch-version.c</a></span></h2>


</div>
<div class="help-para">
The list of Vim patches in <code>src/nvim/version.c</code> is automatically updated
<a href="https://github.com/neovim/neovim/pull/7780">https://github.com/neovim/neovim/pull/7780</a> based on the presence of
<code>vim-patch:xxx</code> tokens in the Nvim git log.

</div>
<div class="help-para">
<div class="help-li" style=""> Don't update <code>src/nvim/version.c</code> yourself.
</div><div class="help-li" style="margin-left: 3rem;"> <code>scripts/vim-patch.sh -p</code> intentionally omits <code>version.c</code> to avoid merge
      conflicts and save time when porting a patch.
</div><div class="help-li" style=""> The automation script (<code>scripts/vimpatch.lua</code>) only recognizes tokens like
  <code>vim-patch:8.0.1206</code>, not <code>vim-patch:&lt;hash&gt;</code>.
</div>
</div>
<div class="help-para">
<h2 id="_code-differences" class="help-heading">CODE DIFFERENCES<span class="help-heading-tags">                            <span id="dev-vimpatch-code-differences" class="help-tag"><a href="#dev-vimpatch-code-differences">dev-vimpatch-code-differences</a></span></h2>


</div>
<div class="help-para">
The following functions have been removed or deprecated in favor of newer
alternatives. See <code>memory.c</code>
<a href="https://github.com/neovim/neovim/blob/master/src/nvim/memory.c">https://github.com/neovim/neovim/blob/master/src/nvim/memory.c</a> for more
information.
<pre>-----------------------------------------------------------------------
Deprecated or removed                                 Replacement
-----------------------------------------------------------------------
vim_free                                                 xfree
VIM_CLEAR(&amp;foo)                                    XFREE_CLEAR(foo)
malloc alloc lalloc lalloc_id ALLOC_ONE                 xmalloc
calloc lalloc_clear                                     xcalloc
realloc vim_realloc                                    xrealloc
mch_memmove                                             memmove
vim_memset copy_chars copy_spaces                       memset
vim_strbyte                                             strchr
vim_strncpy strncpy                               xstrlcpy/xmemcpyz
vim_strcat strncat                                     xstrlcat
VIM_ISWHITE                                          ascii_iswhite
IS_WHITE_OR_NUL                                  ascii_iswhite_or_nul
IS_WHITE_NL_OR_NUL                              ascii_iswhite_nl_or_nul
vim_isalpha                                           mb_isalpha
vim_isNormalIDc                                      ascii_isident
vim_islower vim_isupper                          mb_islower mb_isupper
vim_tolower vim_toupper                          mb_tolower mb_toupper
mb_ptr2len                                           utfc_ptr2len
mb_ptr2len_len                                     utfc_ptr2len_len
mb_char2len                                          utf_char2len
mb_char2bytes                                       utf_char2bytes
mb_ptr2cells                                         utf_ptr2cells
mb_ptr2cells_len                                   utf_ptr2cells_len
mb_char2cells                                       utf_char2cells
mb_off2cells                                         utf_off2cells
mb_ptr2char                                          utf_ptr2char
mb_head_off                                          utf_head_off
mb_tail_off                                          utf_cp_bounds
mb_strnicmp2                                         utf_strnicmp
MB_STRNICMP2                                         utf_strnicmp
mb_lefthalve                                        grid_lefthalve
mb_fix_col                                           grid_fix_col
utf_off2cells                                       grid_off2cells
ml_get_curline                                    get_cursor_line_ptr
ml_get_cursor                                     get_cursor_pos_ptr
ml_get_curline_len                                get_cursor_line_len
ml_get_cursor_len                                 get_cursor_pos_len
screen_char                                             ui_line
screen_line                                        grid_put_linebuf
screen_* (most functions)                               grid_*
update_prepare, update_finish #9484                  removed; use update_screen only
ARRAY_LENGTH                                          ARRAY_SIZE
vim_strsave_escape_csi                           vim_strsave_escape_ks
vim_unescape_csi                                    vim_unescape_ks
gettail                                                path_tail
mch_isFullName                                     path_is_absolute
script_do_profile                                    profile_init
-----------------------------------------------------------------------</pre>

</div>
<div class="help-para">
Make sure to note the difference between <code>utf_</code> and <code>utfc_</code> when replacing
<code>mb_</code> functions. Also indirect call syntax <code>(*mb_ptr2len)(...)</code> should be
replaced with an ordinary function call <code>utfc_ptr2len(...)</code>.
<pre>-----------------------------------------------------------------------
Data type    Format (Vim source)     Portable format (Nvim source)
------------ ----------------------- ----------------------------------
long long    "%lld"                  "%" PRId64
size_t       "%ld"                   "%zu"
linenr_T     "%ld"                   "%" PRIdLINENR
-----------------------------------------------------------------------</pre>

</div>
<div class="help-para">
<div class="help-li" style=""> See also: <a href="https://github.com/neovim/neovim/pull/1729#discussion_r22423779">https://github.com/neovim/neovim/pull/1729#discussion_r22423779</a>
</div><div class="help-li" style=""> Vim's <code>ga_init2</code> was renamed to <code>ga_init</code> and the original <code>ga_init</code> is
  gone.
</div><div class="help-li" style=""> "Old style" Vim tests (<code>src/testdir/*.in</code>) should be converted to Lua tests
  (see #1286 <a href="https://github.com/neovim/neovim/issues/1286">https://github.com/neovim/neovim/issues/1286</a> and #1328
  <a href="https://github.com/neovim/neovim/pull/1328">https://github.com/neovim/neovim/pull/1328</a>). See Checklist for migrating
  legacy tests
  <a href="https://github.com/neovim/neovim/blob/master/test/README.md#checklist-for-migrating-legacy-tests">https://github.com/neovim/neovim/blob/master/test/README.md#checklist-for-migrating-legacy-tests</a>.
</div><div class="help-li" style="margin-left: 3rem;"> However, please do not convert "new style" Vim tests
      (<code>src/testdir/*.vim</code>) to Lua. The "new style" Vim tests are faster than
      the old ones, and converting them takes time and effort better spent
      elsewhere. Just copy them to <code>test/old/testdir/*.vim</code>.
</div><div class="help-li" style=""> Conditions that check <code>enc_utf8</code> or <code>has_mbyte</code> are obsolete (only the
  "true" case is applicable).
</div><div class="help-li" style="margin-left: 3rem;"> <code>enc_utf8</code> and <code>has_mbyte</code> macros were removed in
      <a href="https://github.com/neovim/neovim/pull/13293">https://github.com/neovim/neovim/pull/13293</a>
</div><div class="help-li" style=""> Check for <code>CSI</code> in typeahead buffer is only necessary in Vim with
  <code>FEAT_GUI</code>. <code>CSI</code> does not have a special meaning in typeahead buffer in
  Nvim. (also see <a href="https://github.com/neovim/neovim/pull/16936">https://github.com/neovim/neovim/pull/16936</a>)
</div>
</div>
<div class="help-para">
<h2 id="_list-management" class="help-heading">LIST MANAGEMENT<span class="help-heading-tags">                              <span id="dev-vimpatch-list-management" class="help-tag"><a href="#dev-vimpatch-list-management">dev-vimpatch-list-management</a></span></h2>


</div>
<div class="help-para">
Management of lists (types <code>list_T</code> and <code>listitem_T</code> from vim) was changed in
<a href="https://github.com/neovim/neovim/pull/7708/">https://github.com/neovim/neovim/pull/7708/</a>. There is a lint against the "old"
usage, but here are the most important changes.

</div>
<div class="help-para">
Declarations for the table

</div>
<div class="help-para">
<div class="help-li" style=""> <code>list_T list</code>: a list
</div><div class="help-li" style=""> <code>listitem_T li</code>: an item of <code>list</code>
</div><div class="help-li" style=""> <code>int val</code> a value for <code>lv_copyID</code>
</div>
</div>
<div class="help-para">
<pre>--------------------------------------------------------------------------------------
Old                             New                                  Comment
------------------------------- ------------------------------------------------------
list-&gt;lv_first                  tv_list_first(list)
list-&gt;lv_last                   tv_list_last(list)
li-&gt;li_next                     TV_LIST_ITEM_NEXT(list, li)          To be avoided if possible, must use list which li belongs to.
li-&gt;li_prev                     TV_LIST_ITEM_PREV(list, li)          To be avoided if possible, must use list which li belongs to.
                                Suggestion by @ZyX-l:                Use TV_LIST_ITER or indexing instead of the previous two calls.
list-&gt;lv_len                    tv_list_len(list)
list-&gt;lv_lock                   tv_list_locked(list)
&amp;li-&gt;li_tv                      TV_LIST_ITEM_TV(li)
list-&gt;lv_refcount++             tv_list_ref(list)
val = list-&gt;lv_copyID           val = tv_list_copyid(list)
list-&gt;lv_copyID = val           tv_list_set_copyid(list, val)
for (li = list-&gt;lv_first;       TV_LIST_ITER_CONST(list, li,         Use TV_LIST_ITER(...) if you need to
li != NULL &amp;&amp; another_cond;     { if (another_cond) {break;} code})  modify list items (note: assigning copyID is also modification and this happens
li = li-&gt;li_next) code                                               always when recursively traversing a list).
--------------------------------------------------------------------------------------</pre>

</div>
<div class="help-para">
For more details and some more advanced usage, see <code>typval.h</code> and <code>typval.c</code>.

</div>
<div class="help-para">
<h2 id="_documentation-differences" class="help-heading">DOCUMENTATION DIFFERENCES<span class="help-heading-tags">          <span id="dev-vimpatch-documentation" class="help-tag"><a href="#dev-vimpatch-documentation">dev-vimpatch-documentation</a></span></h2>


</div>
<div class="help-para">
The following should be removed from all imported documentation, and not be
used in new documentation:

</div>
<div class="help-para">
<div class="help-li" style=""> <code>{Only when compiled with ...}</code>: the vast majority of features have been
  made non-optional (see <a href="https://github.com/neovim/neovim/wiki/Introduction">https://github.com/neovim/neovim/wiki/Introduction</a>)
</div>
</div>
<div class="help-para">
<h2 id="_filetype-detection" class="help-heading">FILETYPE DETECTION<span class="help-heading-tags">                 <span id="dev-vimpatch-filetype" class="help-tag"><a href="#dev-vimpatch-filetype">dev-vimpatch-filetype</a></span></h2>


</div>
<div class="help-para">
Nvim's filetype detection behavior matches Vim, but is implemented as part of
<a href="lua.html#vim.filetype">vim.filetype</a> (see <code>$VIMRUNTIME/lua/vim/filetype.lua</code>). The logic is encoded in
three tables, listed in order of precedence (the first match is returned):
1. <code>filename</code> for literal full path or basename lookup;
2. <code>pattern</code> for matching filenames or paths against <a href="luaref.html#lua-pattern">lua-pattern</a>s, optimized
   for fast lookup;
3. <code>extension</code> for literal extension lookup.

</div>
<div class="help-para">
Logic that requires checking file contents or buffer variables is implemented
in <code>$VIMRUNTIME/lua/vim/filetype/detect.lua</code>.

</div>
<div class="help-para">
When porting filetype patches from Vim, keep the following in mind:

</div>
<div class="help-para">
Prefer explicit filenames or extensions over patterns, especially for case
insensitive matches (see <a href="https://github.com/neovim/neovim/pull/29800">https://github.com/neovim/neovim/pull/29800</a>):<pre>"*[mM]akefile" regex -&gt; "makefile", "Makefile" filenames
"*.js\c"       regex -&gt; "js", "jS", "Js", "jS" extensions</pre>
Pattern matching has several differences:
<div class="help-li" style=""> It is done using explicit Lua patterns without implicit anchoring instead
  of Vim regexes:<pre>"*/debian/changelog" -&gt; "/debian/changelog$"
"*/bind/db.*"        -&gt; "/bind/db%."</pre>
</div>
</div>
<div class="help-para">
<div class="help-li" style=""> Filetype patterns are grouped by their parent pattern to improve matching
  performance: If the parent pattern does not match, skip testing all child
  patterns. Note that unlike leaf patterns, parent patterns do not have
  special matching behaviour if they contain a <code>/</code>.
</div>
</div>
<div class="help-para">
  When adding a new filetype with pattern matching, consider the following:
<div class="help-li" style=""> If there is already a group with appropriate parent pattern, use it.
</div><div class="help-li" style=""> If there can be a fast and specific enough pattern to group at least 3
    filetype patterns, add it as a separate grouped entry.
</div>
</div>
<div class="help-para">
  New parent patterns should be
<div class="help-li" style=""> fast: rule of thumb is that it should be a short explicit string
  (i.e. no quantifiers or character sets);
</div><div class="help-li" style=""> specific: rules of thumb, in order:
</div><div class="help-li" style="margin-left: 3rem;"> full directory name (e.g., <code>"/etc/"</code>, <code>"/log/"</code>);
</div><div class="help-li" style="margin-left: 3rem;"> part of a rare enough directory name (e.g., <code>"/conf"</code>, <code>"git/"</code>);
</div><div class="help-li" style="margin-left: 3rem;"> string rarely used in real full paths (e.g., <code>"nginx"</code>).
</div>
</div>
<div class="help-para">
  Example:
<div class="help-li" style=""> Filetype pattern: <code>".*/etc/a2ps/.*%.cfg"</code>
</div><div class="help-li" style=""> Good parents: <code>"/etc/"</code> or <code>"%.cfg$"</code>
</div><div class="help-li" style=""> Bad parents: <code>"%."</code> (fast but not specific) or <code>"/a2ps/.*%."</code> (specific
    but slow)
</div>
</div>
<div class="help-para">
  When modifying an existing regular pattern, make sure that it still fits its
  group.

</div>

  </div>
      <div class="col-narrow toc">
      <div><a href="index.html">Main</a></div>
      <div><a href="vimindex.html">Commands index</a></div>
      <div><a href="quickref.html">Quick reference</a></div>
      <hr/>
  <div class="help-toc-h1"><a href="#_quickstart">QUICKSTART</a>
</div><div class="help-toc-h1"><a href="#_pull-requests">PULL REQUESTS</a>
</div><div class="help-toc-h1"><a href="#_na-(not-applicable)-patches">NA (NOT APPLICABLE) PATCHES</a>
</div><div class="help-toc-h1"><a href="#_version.c">VERSION.C</a>
</div><div class="help-toc-h1"><a href="#_code-differences">CODE DIFFERENCES</a>
</div><div class="help-toc-h1"><a href="#_list-management">LIST MANAGEMENT</a>
</div><div class="help-toc-h1"><a href="#_documentation-differences">DOCUMENTATION DIFFERENCES</a>
</div><div class="help-toc-h1"><a href="#_filetype-detection">FILETYPE DETECTION</a>
</div></div>
</div>
  <footer>
    <div class="container flex">
      <div class="generator-stats">
        Generated at 2025-09-05 05:22 from <code><a href="https://github.com/neovim/neovim/commit/9898327bd7206480ac0b324667ae9fb504941b4a">9898327</a></code>
      </div>
      <div class="generator-stats">
      parse_errors: 0 (<a href="https://github.com/neovim/neovim/issues/new?labels=bug&title=user+docs+HTML%3A+dev_vimpatch.txt+&body=%60gen_help_html.lua%60+problem+at%3A+https://neovim.io/doc/user/dev_vimpatch.html%0D%0DContext%3A%0D%0D%60%60%60%0DTODO%0D%60%60%60" target="_blank">report docs bug...</a>) | <span title="          Nvim
                            NVIM REFERENCE MANUAL
                                         Type &lt;a href="various.html#gO"&gt;gO&lt;/a&gt; to see the table of contents.">noise_lines: 3</span>
      </div>
    <div>

    <!-- algolia docsearch https://docsearch.algolia.com/docs/docsearch-v3/ -->
    <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
    <script type="module">
      docsearch({
        container: '#docsearch',
        appId: 'X185E15FPG',
        apiKey: 'b5e6b2f9c636b2b471303205e59832ed',
        indexName: 'nvim',
      });
    </script>

  </footer>
  </body>
</html>
